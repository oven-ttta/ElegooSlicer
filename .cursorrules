# ElegooSlicer Project Development Rules

> Based on OrcaSlicer, developed by ELEGOO for FDM 3D printing

## Language Requirements
- **All code comments MUST be written in English**
- **All git commit messages MUST be written in English**
- **All variable and function names MUST be in English**
- **File encoding MUST be UTF-8**
- Use clear, descriptive English that explains the "why" behind complex logic
- Keep comments concise and meaningful
- Absolutely NO Chinese characters in code, comments, or commit messages

## Naming Conventions

### C++ (Backend)

**Files and Folders:**
- Project folders and image files: lowercase
- Code files: PascalCase (e.g., `BaseException.cpp`, `MainFrame.hpp`)
- File extensions: lowercase

**Classes, Structs, Enums:**
- Use `PascalCase` (upper camelCase)
  - Example: `class ElegooClass`, `struct ElegooStruct`, `enum ElegooEnum`

**Macros:**
- Use `SCREAMING_SNAKE_CASE`
  - Example: `#define ELEGOO_MACRO 0`

**Namespaces:**
- Use `PascalCase`
  - Example: `namespace ElegooSpace {}`

**Variables:**
- **Local variables**: `camelCase` (lower camelCase)
  - Example: `int elegooVal{0};`
- **Global variables**: `g` prefix + `camelCase`
  - Example: `int gElegoo;`
- **Static variables**: `s` prefix + `camelCase`
  - Example: `int sElegoo;`
- **Member variables**: `m` prefix + `PascalCase`
  - Example: `std::string mName;`
- **Constants**: `c` prefix + `PascalCase`
  - Example: `const int cElegoo = 0;`

**Functions:**
- **Regular functions**: `camelCase`
  - Example: `void elegooFunction(){}`
- **Slot functions**: `slot` prefix + `PascalCase`
  - Example: `void slotElegoo(){}`
- **Signal functions**: `signal` prefix + `PascalCase`
  - Example: `void signalElegoo(){}`

### JavaScript (Frontend)
- **Variables**: Use `camelCase` for variables
  - Example: `userInfo`, `loginStatus`, `avatarUrl`
- **Functions**: Use `camelCase` for function names
  - Example: `onLogout()`, `ipcRequest()`, `checkLoginStatus()`
- **Constants**: Use `SCREAMING_SNAKE_CASE` or `camelCase` with `const`
  - Example: `MAX_RETRY_COUNT`, `const defaultAvatar = ''`
- **Classes**: Use `PascalCase` (same as C++)
  - Example: `NavigationController`, `UserManager`
- **Objects**: Use `camelCase` for object names
  - Example: `userInfo`, `navigationData`

## Code Format and Style

### Encoding and Formatting
- **File encoding**: UTF-8 without BOM
- **Indentation**: 4 spaces (NO tabs)
- **Braces**: Symmetric (opening and closing braces align)
- **Operators**: Add spaces around operators
  - Example: `int result = a + b;` (not `int result=a+b;`)
- **Build system**: Use CMakeLists.txt for all builds

### Code Style Guidelines

### C++ Specific
- Follow existing codebase patterns in `src/libslic3r/` and `src/slic3r/`
- Use `#pragma once` for header guards (not `#ifndef`)
- Prefer smart pointers (`std::unique_ptr`, `std::shared_ptr`) over raw pointers
- Use RAII patterns for resource management
- Keep functions focused and single-purpose

### Comment Standards

**Header File Comments:**
```cpp
// ------------------------------------------
// author: Your Name
// date: 2024/12/18
// copyright: (c) 2024 ELEGOO
// description: This file contains the declaration of the class.
// ------------------------------------------

#ifndef CLASS_NAME_H
#define CLASS_NAME_H
```

**Class/Function/Variable Comments (Doxygen style):**
```cpp
/**
 * @brief A class demonstrating usage.
 */
class ExampleClass {
public:
    /**
     * @brief Constructor for ExampleClass.
     * @param value An integer value to initialize the class.
     */
    ExampleClass(int value);

    /**
     * @brief Get the name value.
     * @return A reference to the name string.
     */
    const std::string& getName() const;

private:
    std::string mName;  //< Member variable storing the name
};
```

### Parameter Passing Rules

1. **Add `const` for parameters that won't be modified**
   - Example: `void process(const std::string& data)`

2. **Use references to avoid copying**
   - Example: `void update(std::vector<int>& vec)` (not `void update(std::vector<int> vec)`)

3. **Prefer references over pointers when possible**
   - Example: `void set(const Config& config)` (not `void set(const Config* config)`)

4. **Consider move semantics for specific scenarios**
   - Example: `void transfer(std::vector<int>&& data)`

5. **Function parameters limit: max 4 parameters**
   - If more than 4, encapsulate into a struct

### JavaScript Specific
- Use ES6+ features (const/let, arrow functions, async/await)
- Prefer `const` over `let` when possible
- Use meaningful variable and function names
- Keep functions small and focused
- Use template literals for string concatenation

## Git Commit Message Standards

### Commit Message Format
```
<type>(<scope>): <subject>

<body>

<footer>
```

### Type (Required)
- **feat**: New feature
- **fix**: Bug fix
- **docs**: Documentation changes
- **style**: Code style changes (formatting, missing semicolons, etc)
- **refactor**: Code refactoring (neither fixes a bug nor adds a feature)
- **perf**: Performance improvements
- **test**: Adding or modifying tests
- **chore**: Changes to build process or auxiliary tools
- **revert**: Reverts a previous commit

### Scope (Optional)
Indicates which part of the codebase is affected:
- `gui`: GUI components
- `slicer`: Core slicing engine
- `network`: Network/cloud features
- `printer`: Printer management
- `config`: Configuration management
- `build`: Build system
- `deps`: Dependencies

### Subject (Required)
- Use imperative mood: "add feature" not "added feature" or "adds feature"
- Start with lowercase
- No period at the end
- Maximum 50 characters
- Be specific and descriptive

### Body (Optional but Recommended)
- Explain WHAT and WHY, not HOW
- Wrap at 72 characters
- Separate from subject with a blank line
- Can include multiple paragraphs

### Footer (Optional)
- Reference issues: `Closes #123`, `Fixes #456`, `Relates to #789`
- Breaking changes: `BREAKING CHANGE: description`

### Examples:

**Good:**
```
feat(gui): add crash test menu for debugging

- Added simple crash test option in Help menu
- Helps verify crash reporting system works correctly
- Only visible in debug/development builds

Closes #234
```

```
fix(CerealTest): fix crash issue in serialization

Fixed crash that occurred when serializing certain objects

1. Modified serialization logic in CerealTest.cpp
2. Added handling for special edge cases

Closes #123
```

```
refactor(network): simplify printer discovery logic

Removed redundant network checks and consolidated printer
status polling into a single method.
```

**Bad:**
```
fixed bug  // Too vague, no context
```

```
fixed stuff  // Too vague
```

```
update code  // Not descriptive enough
```

```
Added new feature.  // Wrong tense (should be "add")
```

### Commit Frequency
- Commit often, but keep commits atomic
- One logical change per commit
- Don't commit broken code
- Don't commit debugging code or commented-out code
- Don't commit unrelated changes together

### Before Committing
- [ ] Run code formatter/linter
- [ ] Remove debugging code
- [ ] Remove commented-out code
- [ ] Test your changes
- [ ] Write meaningful commit message in English

## Commit Content Rules

### What CAN be committed to repository:
- ✅ Source code files (.cpp, .hpp, .js, .html, .css)
- ✅ Build files (CMakeLists.txt, .bat, .sh)
- ✅ Resource files (images, translations, styles)
- ✅ Scripts and configuration files
- ✅ Third-party library headers
- ✅ Unit test code
- ✅ Project documentation

### What CANNOT be committed:
- ❌ Build output/intermediate files (.obj, .o, .exe, .dll without source)
- ❌ Test images and temporary files
- ❌ IDE-specific files (except .cursorrules)
- ❌ Binary files without purpose
- ❌ Personal configuration files

### Important Rules:
- **Configure .gitignore properly** - prevent accidental commits of build artifacts
- **Organize documentation** - put project docs in `doc/` folder
- **Update README** - document common issues and solutions

## File Organization
- C++ files: `src/libslic3r/`, `src/slic3r/GUI/`, `src/dev-utils/`
- JavaScript files: `resources/web/`
- Documentation: `doc/` folder
- Headers: Use `.hpp` extension for C++ headers
- Source: Use `.cpp` extension for C++ implementation
- All text files: **UTF-8 encoding**

## Best Practices

### Function Design
1. **Single Responsibility**: One function implements one feature only
2. **Function Length**: Recommended max 50 lines (guideline, not absolute)
3. **Parameter Limit**: Max 4 parameters; if more, use a struct
4. **Nesting Depth**: Max 3 levels of nesting

### Pointer Safety
```cpp
// ✅ Always check pointers before use
if (ptr != nullptr) {
    ptr->doSomething();
}

// ✅ Use assertions for debug builds
assert(ptr != nullptr && "Pointer should not be null");
ptr->doSomething();

// ✅ Set to nullptr after delete
delete ptr;
ptr = nullptr;
```

### Container Safety
```cpp
// ✅ Check size before accessing
std::vector<int> vec;
int index = 2;
if (index < vec.size()) {
    vec[index] = 0;
}

// ✅ Check queue before popping
std::queue<int> queue;
if (!queue.empty()) {
    queue.pop();
}
```

### Variable Initialization
```cpp
// ✅ Always initialize variables
int elegooVal{0};
std::string name{""};
MyClass* ptr{nullptr};

// ❌ Never use uninitialized variables
int badVal;  // Dangerous!
```

### Code Maintenance
1. **Remove commented-out code** - delete obsolete code promptly
2. **Keep comments synchronized** - update comments when code changes
3. **Exception handling** - add try-catch where appropriate with logging
4. **Use namespaces** - wrap large feature modules in namespaces

### Header File Management
1. **Forward declarations**: Use forward declarations in headers when possible
   ```cpp
   // In .hpp file
   class OtherClass;  // Forward declaration
   
   // In .cpp file
   #include "OtherClass.hpp"  // Include only in implementation
   ```

2. **Include order**: Group headers logically
   ```cpp
   // System headers
   #include <iostream>
   #include <vector>
   
   // C++ standard library
   #include <string>
   #include <memory>
   
   // Third-party libraries
   #include <boost/filesystem.hpp>
   #include <wx/window.h>
   
   // Project headers
   #include "BaseException.h"
   #include "Utils.hpp"
   ```

### Class Design
1. **Member access order**: public → protected → private (no mixing)
   ```cpp
   class ElegooClass {
   public:
       // Public members
   protected:
       // Protected members
   private:
       // Private members
   };
   ```

2. **Encapsulation**: Don't expose members directly; use getters/setters
   ```cpp
   class ElegooClass {
   public:
       const std::string& getName() const { return mName; }
       void setName(const std::string& name) { mName = name; }
   private:
       std::string mName;
   };
   ```

3. **Deep copy**: Implement deep copy for classes with pointers/resources
4. **Move semantics**: Use move constructors for large objects to improve performance

### Code Quality
- **Extensibility**: Design for future extensions, avoid hardcoding
- **Unit tests**: Write tests for new features and submit to repository
- **Unified styles**: Keep UI styles in a single file
- **String resources**: Use English strings; translate as needed

### When Adding New Code:
1. Write all comments in English
2. Follow naming conventions with proper prefixes
3. Initialize all variables
4. Add Doxygen-style comments for public APIs
5. Keep functions focused and readable
6. Consider thread safety and performance

### When Committing:
1. Write commit message in English
2. Use descriptive commit messages
3. Reference related issues if applicable
4. Keep commits atomic (one logical change per commit)
5. Ensure UTF-8 encoding for all files

## Code Review Checklist

### Before Submitting PR
- [ ] All comments are in English
- [ ] Naming conventions followed (camelCase for C++ variables/functions, camelCase for JS)
- [ ] Code follows existing patterns
- [ ] Commit messages are in English and descriptive
- [ ] No Chinese characters anywhere in code
- [ ] No debugging/test code left in
- [ ] No commented-out code (remove or explain why it's there)
- [ ] Code is properly formatted
- [ ] No compiler warnings
- [ ] All tests pass
- [ ] Documentation updated if needed

### Code Quality Standards
- [ ] Functions are focused and single-purpose
- [ ] No magic numbers (use constants)
- [ ] Error handling is appropriate
- [ ] Resource cleanup is proper (RAII in C++)
- [ ] No memory leaks
- [ ] Thread-safety considered for concurrent code
- [ ] Performance impact considered for critical paths

### Security Considerations
- [ ] Input validation implemented
- [ ] No hardcoded credentials
- [ ] Sensitive data properly handled
- [ ] SQL injection prevention (if applicable)
- [ ] Cross-site scripting prevention (if applicable)

## Examples

### Good C++ Code:
```cpp
// Set crash log folder path
void CBaseException::setLogFolder(const std::string& logFolder)
{
    gLogFolder = logFolder;
}

/**
 * @brief Show detailed exception information including system context
 */
void CBaseException::showExceptionInformation()
{
    // Output crash report header
    OutputString(_T("===============================================\r\n"));
    // Output exception details...
}

/**
 * @brief Example class with proper encapsulation
 */
class UserConfig {
public:
    const std::string& getName() const { return mName; }
    void setName(const std::string& name) { mName = name; }
    
private:
    std::string mName;     //< User name
    int mUserId{0};        //< User ID (initialized)
};
```

### Good JavaScript Code:
```javascript
// Handle user logout action
async onLogout() {
    console.log('Logout clicked');
    try {
        await this.ipcRequest('logout', {});
        // Reset user info after successful logout
        this.userInfo.loginStatus = 0;
        this.userInfo.nickname = '';
    } catch (error) {
        console.error('Logout failed:', error);
    }
}
```

### Good Commit Message:
```
fix(CerealTest): fix crash issue in serialization

Fixed crash that occurred when serializing certain objects

1. Modified serialization logic in CerealTest.cpp
2. Added handling for special edge cases

Closes #123
```

---

## Prohibited Practices

### NEVER Do These:
1. **❌ Use Chinese in code, comments, or commit messages**
2. **❌ Commit broken/non-compiling code**
3. **❌ Commit directly to main/master branch**
4. **❌ Force push without team agreement**
5. **❌ Leave debugging code (console.log, printf, etc.)**
6. **❌ Leave commented-out code without explanation**
7. **❌ Use magic numbers (use named constants)**
8. **❌ Ignore compiler warnings**
9. **❌ Skip code review process**
10. **❌ Mix unrelated changes in one commit**

### Code Comments Best Practices
```cpp
// ✅ GOOD: Explain WHY
// Use double buffer to prevent flickering during rapid updates
void renderWithDoubleBuffer() {
    // ...
}

// ✅ GOOD: Explain complex logic
// Binary search requires sorted array. Time complexity: O(log n)
int binarySearch(const std::vector<int>& arr, int target) {
    // ...
}

// ❌ BAD: Stating the obvious
// Increment i
i++;

// ❌ BAD: Using non-English comments
// (Never use Chinese or other non-English languages)
```

### Error Handling Standards
```cpp
// ✅ C++: Use exceptions for exceptional cases
try {
    processFile(filename);
} catch (const std::exception& e) {
    BOOST_LOG_TRIVIAL(error) << "Failed to process file: " << e.what();
    return false;
}

// ✅ Check return values
if (!initializeSystem()) {
    BOOST_LOG_TRIVIAL(error) << "System initialization failed";
    return EXIT_FAILURE;
}
```

```javascript
// ✅ JavaScript: Use try-catch for async operations
try {
    const result = await apiCall();
    return result;
} catch (error) {
    console.error('API call failed:', error);
    throw error;
}
```

### Performance Guidelines
- Profile before optimizing
- Consider Big O complexity for algorithms
- Use appropriate data structures
- Avoid premature optimization
- Cache expensive computations when appropriate
- Be mindful of memory allocations in loops

### Testing Standards
- Write tests for new features
- Update tests when fixing bugs
- Test edge cases and error conditions
- Keep tests focused and readable
- Run all tests before committing

---

## Quick Reference Card

### Naming
- C++ variables/functions: `camelCase`
- C++ classes: `PascalCase`
- Constants: `SCREAMING_SNAKE_CASE`
- JS variables/functions: `camelCase`

### Git Commits
- Format: `<type>(<scope>): <subject>`
- Types: feat, fix, docs, style, refactor, perf, test, chore
- Subject: lowercase, imperative, < 50 chars
- Language: **English ONLY**

### Comments
- Language: **English ONLY**
- Explain WHY, not WHAT
- Keep concise and meaningful

---

**Remember**: 
- ✅ Consistency is key
- ✅ Always use English
- ✅ Code quality over speed
- ✅ Review your own code before submitting
- ✅ Test your changes thoroughly
